<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Exploration: Market Design & Clean Energy Investments</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- MathJax -->
    <script>
        MathJax = {
          tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']],
            displayMath: [['$$', '$$'], ['\\[', '\\]']],
            processEscapes: true,
            processEnvironments: true
          },
          options: {
            skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
          }
        };
      </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script"></script>
    <!-- Custom Styles (Minimal) -->
    <style>
        body {
            font-family: sans-serif;
            line-height: 1.6;
            padding-top: 20px; /* Add padding for fixed navbar if used */
             background-color: #f8f9fa; /* Light background */
        }
        .container {
            max-width: 960px; /* Limit content width */
             background-color: #ffffff; /* White background for content */
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            margin-top: 20px;
            margin-bottom: 20px;
        }
        h1, h2, h3 {
            margin-top: 1.5em;
            margin-bottom: 0.8em;
             color: #343a40; /* Darker heading color */
        }
        h1 {
             border-bottom: 2px solid #dee2e6; /* Separator for main title */
            padding-bottom: 0.3em;
        }
        code {
            background-color: #e9ecef;
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .interactive-section {
            background-color: #f8f9fa; /* Slightly different background for interactive parts */
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }
        .slider-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
             color: #495057;
        }
        input[type=range] {
            width: 100%;
        }
        .output-value {
            font-weight: bold;
            color: #0d6efd; /* Bootstrap primary blue */
        }
         .parameter-controls .col-md-6 {
            margin-bottom: 15px; /* Space between controls */
        }
        .chart-container {
            position: relative;
            height: 350px; /* Adjust as needed */
            width: 100%;
            margin-top: 15px;
        }
        .math-block {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
            overflow-x: auto; /* Handle long equations */
        }
        .reference {
            font-size: 0.8em;
            color: #6c757d;
            margin-top: 20px;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }
        a {
            color: #0d6efd;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">

        <h1>Keeping the Lights On (and Clean!): How Market Rules Shape Our Energy Future</h1>
        <p class="lead">An interactive exploration inspired by the paper: "The impact of market design and clean energy incentives on strategic generation investments and resource adequacy in low-carbon electricity markets" by Kwon et al. (2023).</p>

        <p>Our electricity grids are undergoing a massive transformation. We're adding more wind and solar power (<a href="https://en.wikipedia.org/wiki/Variable_renewable_energy" target="_blank">Variable Renewable Energy</a> or VRE) and energy storage, while facing challenges from climate change and increasing electricity demand (think electric vehicles!). Ensuring a reliable, affordable, and clean power supply during this transition is critical.</p>

        <p>But how do we make sure companies build the *right* mix of power plants for the future? It's not as simple as just calculating the cheapest option. In many parts of the world, including large areas of the U.S., electricity is generated by competing companies (<a href="https://en.wikipedia.org/wiki/Generating_company" target="_blank">Generation Companies</a> or GenCos) selling power through complex wholesale markets operated by <a href="https://en.wikipedia.org/wiki/Independent_system_operator" target="_blank">Independent System Operators</a> (ISOs) or Regional Transmission Organizations (RTOs).</p>

        <p>This paper dives deep into how the *rules* of these markets, along with clean energy policies, influence the crucial investment decisions GenCos make. Will they build enough capacity? Will it be the *right kind* of capacity to keep the system reliable and meet climate goals? Let's explore.</p>

        <h2>Two Ways to Plan: System Cost vs. Company Profit</h2>

        <p>Traditionally, grid planners (especially in areas with vertically integrated utilities that own everything) used models called <a href="https://en.wikipedia.org/wiki/Generation_expansion_planning" target="_blank">Generation Expansion Planning</a> (GEP) models. The goal was simple: find the cheapest mix of power plants to build and retire over time, while meeting projected electricity demand and maintaining a safety buffer of extra capacity.</p>

        <h3>The Planner's View: Least-Cost Generation Expansion Planning (LC-GEP)</h3>
        <p>Imagine a central planner looking at the whole system. Their goal is to minimize the total cost (building new plants + running them + fuel + retiring old ones) while ensuring there's enough power available even if some plants are down or demand spikes. This "safety buffer" is often measured by the <a href="https://en.wikipedia.org/wiki/Resource_adequacy#Planning_Resource_adequacy" target="_blank">Planning Reserve Margin</a> (PRM) â€“ the percentage of extra capacity available above the expected peak demand.</p>
        <p>Mathematically, this looks something like (in a very simplified form):</p>
        <div class="math-block">
        $$ \min_{\text{Investments}} \sum_{\text{years}} (\text{Investment Costs} + \text{Operating Costs}) $$
        Subject to:
        <ul>
            <li>Total Capacity $\ge$ Peak Demand $\times$ (1 + Target PRM)</li>
            <li>Meet energy demand each hour</li>
            <li>Technical limits (ramp rates, transmission, etc.)</li>
        </ul>
        </div>
        <p>This approach aims for a "socially optimal" outcome from a cost perspective.</p>

        <h3>The Company's View: Strategic Investment (SCIM/EPEC)</h3>
        <p>However, in competitive markets, individual GenCos aren't trying to minimize system cost. They are trying to **maximize their own profit**. They make investment decisions based on expected revenues from selling energy, capacity (in some markets), and potentially clean energy credits, minus their costs.</p>
        <p>Crucially, these GenCos act strategically. They know their decisions (and the decisions of their competitors) will affect market prices. Building a new plant might lower energy prices, affecting everyone's revenue. This complex interplay is what the paper models using a game-theoretic approach called an <a href="https://en.wikipedia.org/wiki/Mathematical_program_with_equilibrium_constraints" target="_blank">Equilibrium Problem with Equilibrium Constraints</a> (EPEC). It tries to find a <a href="https://en.wikipedia.org/wiki/Nash_equilibrium" target="_blank">Nash Equilibrium</a> where no GenCo can improve its profit by unilaterally changing its investment strategy, given what all other GenCos are doing and how the markets are expected to clear.</p>
        <p>A single GenCo's simplified goal might look like:</p>
        <div class="math-block">
        $$ \max_{\text{My Investments}} \sum_{\text{years}} (\text{Market Revenues} - \text{My Costs}) $$
        Where Market Revenues depend on:
        <ul>
            <li>Energy market prices (influenced by *all* GenCos' supply)</li>
            <li>Capacity market prices (if applicable, also influenced by total supply)</li>
            <li>Clean energy credit prices (if applicable)</li>
            <li>My own plant operations</li>
        </ul>
        </div>
        <p>The EPEC model links multiple such profit-maximization problems together, constrained by the market clearing mechanisms. This is much more complex but potentially more realistic for competitive markets.</p>


        <h2>Market Mechanisms Matter: Energy, Capacity, and Clean Attributes</h2>
        <p>The paper explores how different market designs influence strategic investments. Let's look at the key ones:</p>

        <h3>1. Energy & Ancillary Services Market</h3>
        <p>This is the basic market where electricity is bought and sold, usually on an hourly or sub-hourly basis. Generators offer power at their marginal cost, and the system operator dispatches the cheapest resources to meet demand. The price is set by the most expensive generator needed (<a href="https://en.wikipedia.org/wiki/Locational_marginal_pricing" target="_blank">Locational Marginal Pricing</a> or LMP). Ancillary services (like reserves to handle sudden outages) are also procured.</p>
        <p>In an "Energy-Only" market (like Texas' ERCOT), generators must recover *all* their costs (including building the plant) just from selling energy and ancillary services. This can be challenging, especially for plants that run infrequently (peaker plants) or for renewables with zero fuel cost but high upfront investment. This leads to the "missing money" problem and potential reliance on very high prices during scarcity events.</p>

        <h3>2. Capacity Market (CM)</h3>
        <p>To address the "missing money" problem and ensure long-term reliability, many ISOs/RTOs run Capacity Markets. GenCos get paid not just for producing energy, but for simply *being available* to produce energy in the future (typically 1-3 years ahead). This provides a more stable revenue stream, especially for resources needed for reliability but not running constantly.</p>
        <p>Capacity markets typically use a demand curve set by the ISO/RTO, reflecting the desired level of reliability (related to the Target PRM). GenCos offer their capacity, and the market clears where the supply meets the demand curve.</p>

        <div class="interactive-section">
            <h4>Interactive Capacity Market Clearing</h4>
            <p>Adjust the capacity demand curve parameters to see how it affects the clearing price and quantity. Assume a fixed total available supply from generators for simplicity.</p>
            <div class="row parameter-controls">
                <div class="col-md-6">
                    <label for="cmDemandIntercept" class="form-label slider-label">Demand Curve Intercept (Max Price willingness): $<span id="cmDemandInterceptValue">250</span>/MW-day</label>
                    <input type="range" class="form-range" id="cmDemandIntercept" min="100" max="400" value="250" step="10">
                </div>
                <div class="col-md-6">
                    <label for="cmDemandTarget" class="form-label slider-label">Target Capacity Quantity (where curve starts dropping): <span id="cmDemandTargetValue">90</span> GW</label>
                    <input type="range" class="form-range" id="cmDemandTarget" min="80" max="100" value="90" step="1">
                </div>
                 <div class="col-md-6">
                    <label for="cmSupply" class="form-label slider-label">Available Supply: <span id="cmSupplyValue">95</span> GW</label>
                    <input type="range" class="form-range" id="cmSupply" min="85" max="105" value="95" step="1">
                </div>
                 <div class="col-md-6">
                    <p>Clearing Price: <span id="cmClearingPrice" class="output-value">?</span> $/MW-day</p>
                    <p>Clearing Quantity: <span id="cmClearingQuantity" class="output-value">?</span> GW</p>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="capacityMarketChart"></canvas>
            </div>
            <p><small>Note: This is a simplified representation. Real capacity markets have complex offer rules, performance requirements, and multi-year commitments.</small></p>
        </div>

        <h3>3. Clean Energy Market (CEM)</h3>
        <p>As decarbonization goals become more prominent, new market mechanisms are being considered. A Clean Energy Market (or similar concepts like Clean Energy Standards) aims to directly procure "clean attributes" from eligible resources (like wind, solar, nuclear, hydro).</p>
        <p>Similar to a capacity market, a CEM could have a demand curve reflecting a clean energy target or the social cost of carbon. Eligible generators would receive revenue for the clean energy they provide, in addition to energy/capacity revenues.</p>
        <p>The paper models a CEM with a downward-sloping demand curve, assuming resources like PV, wind, nuclear, and hydro are eligible.</p>
         <!-- Optional: Add a similar interactive chart for CEM if desired, structure like CM -->


        <h2>Exploring the Trade-offs: LC-GEP vs. SCIM Investments</h2>
        <p>Now for the core comparison. How do the investment outcomes differ when we look through the lens of system-wide cost minimization (LC-GEP) versus profit-driven strategic behavior (SCIM)?</p>
        <p>The paper finds significant differences, especially in the resulting Planning Reserve Margin (PRM) and the technology mix.</p>

        <div class="interactive-section">
            <h4>Interactive Investment Scenario</h4>
            <p>Let's simulate a simplified scenario. Adjust the parameters below to see how the generation mix and PRM might change under the two modeling approaches. We'll consider four main technology types: Natural Gas (NGCT - Peaker), Solar PV, Wind, and Battery Storage (4-hour).</p>

            <div class="row parameter-controls">
                <div class="col-md-6">
                    <label for="solarCostFactor" class="form-label slider-label">Solar Cost Factor (1=Base, <1 Cheaper): <span id="solarCostFactorValue">1.0</span></label>
                    <input type="range" class="form-range" id="solarCostFactor" min="0.7" max="1.3" value="1.0" step="0.05">
                </div>
                <div class="col-md-6">
                    <label for="storageCostFactor" class="form-label slider-label">Storage Cost Factor (1=Base, <1 Cheaper): <span id="storageCostFactorValue">1.0</span></label>
                    <input type="range" class="form-range" id="storageCostFactor" min="0.6" max="1.4" value="1.0" step="0.05">
                </div>
                 <div class="col-md-6">
                    <label for="marketType" class="form-label slider-label">Market Type:</label>
                    <select class="form-select" id="marketType">
                        <option value="EO" selected>Energy Only (EO)</option>
                        <option value="CM_Weak">Weak Capacity Market (CM)</option>
                        <option value="CM_Strong">Strong Capacity Market (CM)</option>
                    </select>
                </div>
                 <div class="col-md-6">
                    <label for="policy" class="form-label slider-label">Clean Policy:</label>
                    <select class="form-select" id="policy">
                        <option value="None" selected>None</option>
                        <option value="TC">Renewable Tax Credits (TC)</option>
                        <option value="CP">Carbon Price (CP)</option>
                    </select>
                </div>
            </div>

             <div class="row mt-3">
                <div class="col-md-6">
                    <h5>LC-GEP Outcome (System Cost Focus)</h5>
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="lcgepMixChart"></canvas>
                    </div>
                    <p class="text-center mt-2">Resulting PRM: <span id="lcgepPRM" class="output-value">?</span>%</p>
                </div>
                <div class="col-md-6">
                    <h5>SCIM Outcome (Profit Focus)</h5>
                     <div class="chart-container" style="height: 300px;">
                        <canvas id="scimMixChart"></canvas>
                    </div>
                     <p class="text-center mt-2">Resulting PRM: <span id="scimPRM" class="output-value">?</span>%</p>
                </div>
            </div>
            <p class="mt-3"><small>Disclaimer: This is a highly simplified simulation based on the paper's general findings. Actual results depend on numerous complex factors and detailed modeling. The goal here is to illustrate the *directional* impacts of different parameters and market structures.</small></p>
        </div>


        <h2>Key Findings from the Paper (Illustrated Above)</h2>

        <ul>
            <li><strong>Profit vs. Cost Leads to Different Outcomes:</strong> The SCIM (profit-driven) model often results in significantly lower Planning Reserve Margins (PRMs) compared to the LC-GEP (cost-minimization) model, especially in Energy-Only markets. This suggests that relying solely on energy market revenues might not incentivize enough capacity investment from a system reliability perspective, or that GenCos might strategically withhold investment to boost prices.</li>
            <li><strong>Capacity Markets Help, But Don't Equalize:</strong> Introducing a capacity market generally brings the SCIM results closer to the target PRM. However, the *mix* of technologies chosen can still differ substantially between SCIM and LC-GEP even with similar PRMs. For instance, SCIM might favor technologies with higher capacity market revenues, while LC-GEP focuses purely on the lowest system cost to meet energy and reliability needs.</li>
            <li><strong>Market Design Details are Crucial:</strong> The specific design of the capacity market (e.g., the shape of the demand curve, as simulated interactively above) and energy market price caps significantly influence which technologies get built. Higher price caps or steeper demand curves can incentivize different types of resources.</li>
            <li><strong>Renewables Dominate New Builds:</strong> In almost all scenarios studied, wind and solar make up the majority of *new* investments, reflecting their falling costs. However, the *amount* and the supporting cast (gas peakers, storage) vary greatly.</li>
            <li><strong>Incentives Shift the Mix:</strong>
                <ul>
                    <li><strong>Tax Credits (TC):</strong> Directly lower the cost of renewables, leading to more wind and solar deployment in both LC-GEP and SCIM models, sometimes displacing gas investments.</li>
                    <li><strong>Carbon Pricing (CP):</strong> Makes fossil fuels more expensive to operate, increasing the competitiveness of renewables and storage, and potentially incentivizing carbon capture (NGCC-CCS) or nuclear. It significantly increases PRM in the SCIM Energy-Only case by making cleaner resources more valuable during scarcity.</li>
                    <li><strong>Clean Energy Markets (CEM):</strong> Provide an additional revenue stream for clean resources. The paper found its impact was modest in the Energy-Only case at the assumed price, but more significant alongside a Capacity Market, promoting more renewables and storage over gas.</li>
                </ul>
            </li>
        </ul>

        <h2>Limitations and Why This Matters</h2>
        <p>The authors acknowledge limitations, such as simplifying the number of competing GenCos and using PRM as the primary reliability metric. Real-world reliability is more complex, and market power dynamics can be intricate.</p>

        <p>However, this research highlights a critical point: **we cannot design effective electricity markets or climate policies without understanding and modeling the strategic behavior of the companies making investment decisions.** Relying solely on traditional least-cost models might give a misleading picture of the future grid. Market rules need to be carefully designed to align private incentives with public goals for reliability, affordability, and decarbonization.</p>

        <h2>Conclusion</h2>
        <p>The transition to a clean energy future requires not only technological innovation but also smart market design. As this paper demonstrates, the rules governing how electricity is bought and sold have profound impacts on investment decisions and ultimately on the reliability and cleanliness of our power supply. By using sophisticated models like SCIM/EPEC alongside traditional approaches, planners and policymakers can better anticipate challenges and design markets that effectively guide the necessary investments for a sustainable energy future.</p>

        <div class="reference">
            <p>Based on: Kwon, J., Levin, T., Zhou, Z., Botterud, A., Mehrtash, M., & Hobbs, B. F. (2023). The impact of market design and clean energy incentives on strategic generation investments and resource adequacy in low-carbon electricity markets. <em>Renewable Energy Focus, 47</em>, 100495. <a href="https://doi.org/10.1016/j.ref.2023.100495" target="_blank">https://doi.org/10.1016/j.ref.2023.100495</a></p>
            <p>Interactive visualizations created for illustrative purposes using Chart.js and simplified assumptions inspired by the paper's findings.</p>
        </div>

    </div>

    <!-- Bootstrap Bundle JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <!-- Custom Javascript -->
    <script>
        // --- Capacity Market Chart Logic ---
        const cmCtx = document.getElementById('capacityMarketChart').getContext('2d');
        const cmDemandInterceptSlider = document.getElementById('cmDemandIntercept');
        const cmDemandTargetSlider = document.getElementById('cmDemandTarget');
        const cmSupplySlider = document.getElementById('cmSupply');
        const cmDemandInterceptValueSpan = document.getElementById('cmDemandInterceptValue');
        const cmDemandTargetValueSpan = document.getElementById('cmDemandTargetValue');
        const cmSupplyValueSpan = document.getElementById('cmSupplyValue');
        const cmClearingPriceSpan = document.getElementById('cmClearingPrice');
        const cmClearingQuantitySpan = document.getElementById('cmClearingQuantity');

        let capacityMarketChart;

        function createCapacityDemandCurveData(intercept, target, slopeRegionWidth = 10, minQty = 70, maxQty = 110) {
            const data = [];
            const step = 0.5; // Granularity for plotting
            const slope = -intercept / slopeRegionWidth; // Simple linear slope

            for (let qty = minQty; qty <= maxQty; qty += step) {
                let price;
                if (qty <= target) {
                    price = intercept; // Flat part
                } else if (qty <= target + slopeRegionWidth) {
                    price = intercept + slope * (qty - target); // Sloping part
                } else {
                    price = 0; // Price hits zero
                }
                price = Math.max(0, price); // Ensure price doesn't go negative
                data.push({ x: qty, y: price });
            }
            return data;
        }

        function createCapacitySupplyCurveData(supplyQty, minQty = 70, maxQty = 110, price = 400) {
            // Vertical supply curve at the given quantity
             return [
                { x: supplyQty, y: 0 },
                { x: supplyQty, y: price } // Extend up to max price for visibility
            ];
        }

         function findIntersection(demandData, supplyQty) {
            let clearingPrice = 0;
            // Find the price on the demand curve at the supply quantity
            for (let i = 0; i < demandData.length; i++) {
                // Find the segment that contains the supply quantity
                 if (demandData[i].x >= supplyQty) {
                     // Simple approach: take the price at the first point >= supplyQty
                     // More accurate: linear interpolation between points straddling supplyQty
                     if (i > 0 && demandData[i-1].x < supplyQty) {
                         // Interpolate
                         const x1 = demandData[i-1].x, y1 = demandData[i-1].y;
                         const x2 = demandData[i].x, y2 = demandData[i].y;
                         if (x2 - x1 > 0) { // Avoid division by zero
                            clearingPrice = y1 + (y2 - y1) * (supplyQty - x1) / (x2 - x1);
                         } else {
                            clearingPrice = demandData[i].y; // Vertical segment? Use the point's price
                         }
                     } else {
                        clearingPrice = demandData[i].y; // Exactly on a point or first point >=
                     }
                     break; // Found the relevant price
                 }
                 // If supplyQty is beyond the plotted demand curve, price is effectively 0
                 if (i === demandData.length - 1 && demandData[i].x < supplyQty) {
                     clearingPrice = 0;
                 }
            }
             return { price: Math.max(0, clearingPrice), quantity: supplyQty }; // Price cannot be negative
        }

        function updateCapacityMarketChart() {
            const intercept = parseFloat(cmDemandInterceptSlider.value);
            const target = parseFloat(cmDemandTargetSlider.value);
            const supply = parseFloat(cmSupplySlider.value);

            cmDemandInterceptValueSpan.textContent = intercept;
            cmDemandTargetValueSpan.textContent = target;
            cmSupplyValueSpan.textContent = supply;

            const demandData = createCapacityDemandCurveData(intercept, target);
            const supplyData = createCapacitySupplyCurveData(supply, 70, 110, intercept * 1.1); // Extend supply line visually

            const intersection = findIntersection(demandData, supply);
            cmClearingPriceSpan.textContent = intersection.price.toFixed(2);
            cmClearingQuantitySpan.textContent = intersection.quantity.toFixed(2);


            if (capacityMarketChart) {
                capacityMarketChart.data.datasets[0].data = demandData;
                capacityMarketChart.data.datasets[1].data = supplyData;
                 capacityMarketChart.data.datasets[2].data = [{ x: intersection.quantity, y: intersection.price }]; // Update intersection point
                capacityMarketChart.update();
            } else {
                capacityMarketChart = new Chart(cmCtx, {
                    type: 'scatter', // Use scatter for arbitrary x,y points
                    data: {
                        datasets: [
                            {
                                label: 'Capacity Demand Curve',
                                data: demandData,
                                borderColor: 'rgb(255, 99, 132)',
                                backgroundColor: 'rgba(255, 99, 132, 0.5)',
                                showLine: true, // Connect the points
                                tension: 0, // Straight lines between points
                                pointRadius: 0, // Hide individual points
                                borderWidth: 2
                            },
                            {
                                label: 'Available Supply',
                                data: supplyData,
                                borderColor: 'rgb(54, 162, 235)',
                                backgroundColor: 'rgba(54, 162, 235, 0.5)',
                                showLine: true,
                                tension: 0,
                                pointRadius: 0,
                                borderWidth: 3,
                                borderDash: [5, 5] // Dashed line for supply
                            },
                             {
                                label: 'Clearing Point',
                                data: [{ x: intersection.quantity, y: intersection.price }],
                                borderColor: 'rgb(75, 192, 192)',
                                backgroundColor: 'rgb(75, 192, 192)',
                                pointRadius: 6,
                                pointHoverRadius: 8,
                                showLine: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                         scales: {
                            x: {
                                type: 'linear',
                                position: 'bottom',
                                title: {
                                    display: true,
                                    text: 'Capacity Quantity (GW)'
                                },
                                min: 70, // Adjust axis limits as needed
                                max: 110
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Capacity Price ($/MW-day)'
                                },
                                min: 0,
                                max: Math.max(400, intercept * 1.1) // Ensure intercept is visible
                            }
                        },
                        plugins: {
                            tooltip: {
                                enabled: false // Disable default tooltip for lines, enable for point
                            },
                            legend: {
                                position: 'top',
                            },
                        }
                    }
                });
            }
        }

        cmDemandInterceptSlider.addEventListener('input', updateCapacityMarketChart);
        cmDemandTargetSlider.addEventListener('input', updateCapacityMarketChart);
        cmSupplySlider.addEventListener('input', updateCapacityMarketChart);

        // --- Investment Scenario Simulation ---
        const solarCostFactorSlider = document.getElementById('solarCostFactor');
        const storageCostFactorSlider = document.getElementById('storageCostFactor');
        const marketTypeSelect = document.getElementById('marketType');
        const policySelect = document.getElementById('policy');
        const solarCostFactorValueSpan = document.getElementById('solarCostFactorValue');
        const storageCostFactorValueSpan = document.getElementById('storageCostFactorValue');
        const lcgepPRMSpan = document.getElementById('lcgepPRM');
        const scimPRMSpan = document.getElementById('scimPRM');
        const lcgepCtx = document.getElementById('lcgepMixChart').getContext('2d');
        const scimCtx = document.getElementById('scimMixChart').getContext('2d');

        let lcgepMixChart, scimMixChart;

        // Simplified base parameters (relative capacity contributions)
        // These are NOT real MW, just relative proportions for illustration
        const baseParams = {
            targetPRM: 12.5, // Target % for LC-GEP baseline
            baseCapacity: { ngct: 20, solar: 25, wind: 30, storage: 5 }, // Example starting mix
             costs: { ngct: 1.0, solar: 1.0, wind: 1.0, storage: 1.0 }, // Relative cost factors
            capacityCredits: { ngct: 0.95, solar: 0.5, wind: 0.2, storage: 0.9 } // Example capacity contribution factors
        };

        function calculateInvestmentMix(params, modelType) {
            // *** This is the core simplification ***
            // It mimics trends observed in the paper, not a real optimization.
            let mix = { ...baseParams.baseCapacity }; // Start with base
            let totalCapacity = Object.values(mix).reduce((a, b) => a + b, 0);
            let targetCapacityLCGEP = 100 * (1 + params.targetPRM / 100); // Assume base demand = 100 units

            // Adjustments based on cost factors
            mix.solar *= (1 / params.costs.solar); // Cheaper solar -> more solar potential
            mix.storage *= (1 / params.costs.storage);
            mix.wind *= (1 / params.costs.wind); // Add wind cost factor if needed

            // Policy adjustments
            let carbonPenalty = (params.policy === 'CP') ? 0.3 : 0; // Penalize NGCT cost
            let tcBonus = (params.policy === 'TC') ? 1.5 : 1.0; // Boost renewables value/reduce effective cost
             mix.ngct *= (1 / (1 + carbonPenalty));
             mix.solar *= tcBonus;
             mix.wind *= tcBonus;


             // Market type adjustments (Primarily affects SCIM PRM and mix)
             let capacityMarketStrength = 0; // 0: EO, 1: Weak CM, 2: Strong CM
             if (params.marketType === 'CM_Weak') capacityMarketStrength = 1;
             if (params.marketType === 'CM_Strong') capacityMarketStrength = 2;

             // --- LC-GEP Logic (Cost Minimization to meet PRM) ---
             if (modelType === 'LC-GEP') {
                 // Very simple: scale cheapest resources to meet PRM target
                 // Re-normalize mix based on adjusted costs (lower cost = higher share potential)
                 let costAdjustedSum = (mix.ngct / params.costs.ngct) + (mix.solar / params.costs.solar) + (mix.wind / params.costs.wind) + (mix.storage / params.costs.storage);
                 let finalMixLC = {};
                 finalMixLC.ngct = (mix.ngct / params.costs.ngct) / costAdjustedSum * targetCapacityLCGEP;
                 finalMixLC.solar = (mix.solar / params.costs.solar) / costAdjustedSum * targetCapacityLCGEP;
                 finalMixLC.wind = (mix.wind / params.costs.wind) / costAdjustedSum * targetCapacityLCGEP;
                 finalMixLC.storage = (mix.storage / params.costs.storage) / costAdjustedSum * targetCapacityLCGEP;

                 let finalCapacityLC = Object.values(finalMixLC).reduce((a, b) => a + b, 0);
                 let prmLC = (finalCapacityLC / 100 - 1) * 100; // Assume base demand = 100

                 return { mix: finalMixLC, prm: prmLC };
             }

             // --- SCIM Logic (Profit Maximization - tends to lower PRM in EO) ---
             if (modelType === 'SCIM') {
                 let finalMixSCIM = { ...mix }; // Start with cost/policy adjusted mix

                 // Scale total capacity based on market type (EO tends lower, CM higher)
                 let capacityScaleFactor = 1.0;
                 if (capacityMarketStrength === 0) capacityScaleFactor = 0.92 - carbonPenalty * 0.1; // EO: Lower PRM, CP increases it somewhat
                 if (capacityMarketStrength === 1) capacityScaleFactor = 0.98; // Weak CM: Closer to target
                 if (capacityMarketStrength === 2) capacityScaleFactor = 1.02; // Strong CM: Near or slightly above target

                 // In CM, value resources with high capacity credits more
                  if (capacityMarketStrength > 0) {
                      finalMixSCIM.ngct *= (1 + params.capacityCredits.ngct * capacityMarketStrength * 0.1);
                      finalMixSCIM.storage *= (1 + params.capacityCredits.storage * capacityMarketStrength * 0.1);
                      // Solar/Wind less affected or might be slightly reduced relatively if credits low
                       finalMixSCIM.solar *= (1 + params.capacityCredits.solar * capacityMarketStrength * 0.05);
                       finalMixSCIM.wind *= (1 + params.capacityCredits.wind * capacityMarketStrength * 0.05);
                  }

                 // Normalize and scale total capacity
                 let currentSumSCIM = Object.values(finalMixSCIM).reduce((a, b) => a + b, 0);
                 let targetCapacitySCIM = 100 * (1 + params.targetPRM / 100) * capacityScaleFactor; // Scale target based on market

                 Object.keys(finalMixSCIM).forEach(key => {
                     finalMixSCIM[key] = (finalMixSCIM[key] / currentSumSCIM) * targetCapacitySCIM;
                 });

                 let finalCapacitySCIM = Object.values(finalMixSCIM).reduce((a, b) => a + b, 0);
                 let prmSCIM = (finalCapacitySCIM / 100 - 1) * 100; // Assume base demand = 100

                 return { mix: finalMixSCIM, prm: prmSCIM };
             }

            return { mix: { ngct: 0, solar: 0, wind: 0, storage: 0 }, prm: 0 }; // Default fallback
        }

        function updateInvestmentCharts() {
            const solarCostFactor = parseFloat(solarCostFactorSlider.value);
            const storageCostFactor = parseFloat(storageCostFactorSlider.value);
            const marketType = marketTypeSelect.value;
            const policy = policySelect.value;

            solarCostFactorValueSpan.textContent = solarCostFactor.toFixed(2);
            storageCostFactorValueSpan.textContent = storageCostFactor.toFixed(2);

            const currentParams = {
                ...baseParams,
                 costs: { ngct: 1.0, solar: solarCostFactor, wind: 1.0, storage: storageCostFactor },
                marketType: marketType,
                policy: policy
            };

            const lcgepResult = calculateInvestmentMix(currentParams, 'LC-GEP');
            const scimResult = calculateInvestmentMix(currentParams, 'SCIM');

            lcgepPRMSpan.textContent = lcgepResult.prm.toFixed(1);
            scimPRMSpan.textContent = scimResult.prm.toFixed(1);

            const chartLabels = ['NGCT', 'Solar PV', 'Wind', 'Storage'];
            const lcgepData = chartLabels.map(label => lcgepResult.mix[label.toLowerCase().replace(' pv', '')] || 0);
            const scimData = chartLabels.map(label => scimResult.mix[label.toLowerCase().replace(' pv', '')] || 0);

             const backgroundColors = [
                'rgba(255, 159, 64, 0.7)', // Orange (NGCT)
                'rgba(255, 205, 86, 0.7)', // Yellow (Solar)
                'rgba(54, 162, 235, 0.7)', // Blue (Wind)
                'rgba(75, 192, 192, 0.7)'  // Teal (Storage)
            ];
             const borderColors = [
                'rgb(255, 159, 64)',
                'rgb(255, 205, 86)',
                'rgb(54, 162, 235)',
                'rgb(75, 192, 192)'
            ];


            // Update or create LC-GEP Chart
            if (lcgepMixChart) {
                lcgepMixChart.data.datasets[0].data = lcgepData;
                lcgepMixChart.update();
            } else {
                lcgepMixChart = new Chart(lcgepCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Generation Mix'], // Single bar stack
                        datasets: chartLabels.map((label, index) => ({
                             label: label,
                             data: [lcgepData[index]], // Data needs to be in an array for single bar
                             backgroundColor: backgroundColors[index],
                             borderColor: borderColors[index],
                             borderWidth: 1
                         }))
                    },
                    options: {
                        indexAxis: 'y', // Horizontal bars look better for single stack
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: { stacked: true, title: { display: true, text: 'Relative Capacity Units' } },
                            y: { stacked: true, display: false } // Hide y-axis label for single bar
                        },
                        plugins: {
                            legend: { display: true, position: 'bottom' },
                            tooltip: {
                                callbacks: {
                                     label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.x !== null) {
                                            label += context.parsed.x.toFixed(1);
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            }

             // Update or create SCIM Chart
            if (scimMixChart) {
                scimMixChart.data.datasets.forEach((dataset, index) => {
                    dataset.data = [scimData[index]];
                });
                scimMixChart.update();
            } else {
                 scimMixChart = new Chart(scimCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Generation Mix'],
                         datasets: chartLabels.map((label, index) => ({
                             label: label,
                             data: [scimData[index]],
                             backgroundColor: backgroundColors[index],
                             borderColor: borderColors[index],
                             borderWidth: 1
                         }))
                    },
                     options: { // Same options as LCGEP chart
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: { stacked: true, title: { display: true, text: 'Relative Capacity Units' } },
                            y: { stacked: true, display: false }
                        },
                        plugins: {
                            legend: { display: true, position: 'bottom' },
                             tooltip: { // Same tooltip callback
                                callbacks: {
                                     label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) { label += ': '; }
                                        if (context.parsed.x !== null) { label += context.parsed.x.toFixed(1); }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        solarCostFactorSlider.addEventListener('input', updateInvestmentCharts);
        storageCostFactorSlider.addEventListener('input', updateInvestmentCharts);
        marketTypeSelect.addEventListener('change', updateInvestmentCharts);
        policySelect.addEventListener('change', updateInvestmentCharts);


        // --- Initial Chart Setup ---
        document.addEventListener('DOMContentLoaded', () => {
            updateCapacityMarketChart();
            updateInvestmentCharts();
        });

    </script>

</body>
</html>