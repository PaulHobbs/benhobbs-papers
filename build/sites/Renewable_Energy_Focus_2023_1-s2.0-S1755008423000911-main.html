<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Exploration: Market Design & Clean Energy Investments</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <!-- MathJax Configuration -->
    <script>
        MathJax = {
          tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']],
            displayMath: [['$$', '$$'], ['\\[', '\\]']],
            processEscapes: true,
            processEnvironments: true
          },
          options: {
            skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
          }
        };
      </script>
    <!-- MathJax Script -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script"></script>
    <!-- D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- Custom Minimal CSS -->
    <style>
        body {
            font-family: sans-serif;
            line-height: 1.6;
            padding-top: 20px;
        }
        h1, h2, h3 {
            margin-top: 1.5em;
            margin-bottom: 0.5em;
        }
        code {
            background-color: #f8f9fa;
            padding: 2px 4px;
            border-radius: 4px;
        }
        .interactive-section {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 20px;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type=range] {
            width: 100%;
        }
        .value-display {
            font-weight: bold;
            color: #0d6efd; /* Bootstrap primary blue */
        }
        svg {
            display: block;
            margin: auto;
            font-family: sans-serif;
        }
        .bar {
            fill: steelblue;
        }
        .bar:hover {
            fill: lightblue;
        }
        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }
        .axis text {
            font-size: 10px;
        }
        .tooltip {
            position: absolute;
            text-align: center;
            padding: 6px;
            font: 12px sans-serif;
            background: lightsteelblue;
            border: 0px;
            border-radius: 8px;
            pointer-events: none;
            opacity: 0;
        }
        .highlight {
             font-weight: bold;
             color: #dc3545; /* Bootstrap danger red */
        }
        .tech-wind { fill: #6baed6; }
        .tech-solar { fill: #fdbe85; }
        .tech-storage { fill: #a1d99b; }
        .tech-gas { fill: #bdbdbd; }
        .tech-nuclear { fill: #fdd0a2; }
        .tech-coal { fill: #969696; }
        .tech-other { fill: #ce1256; }
        .legend-label {
            font-size: 0.8em;
            margin-right: 10px;
        }
        .legend-color {
            display: inline-block;
            width: 12px;
            height: 12px;
            margin-right: 5px;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="mb-4 p-3 bg-light rounded">
            <h1>Interactive Exploration: How Market Rules Shape Our Power Grid</h1>
            <p class="lead">Based on the paper: "The impact of market design and clean energy incentives on strategic generation investments and resource adequacy in low-carbon electricity markets" by Kwon et al. (2023).</p>
            <p><a href="https://doi.org/10.1016/j.ref.2023.100495" target="_blank">Link to Original Paper (DOI)</a></p>
            <p><strong>Abstract Summary:</strong> Our electricity grid needs to be reliable and increasingly clean. This paper explores how different rules for electricity markets (like how generators get paid) and incentives for clean energy influence companies' decisions to build new power plants (like wind, solar, batteries, gas) and how reliable the overall system ends up being.</p>
        </header>

        <section>
            <h2>The Challenge: Building Tomorrow's Power Grid</h2>
            <p>Our society relies heavily on electricity. With more things going electric (like cars and heating) and the urgent need to tackle climate change, our power grid is undergoing a massive transformation. We're seeing more <a href="https://en.wikipedia.org/wiki/Variable_renewable_energy" target="_blank">Variable Renewable Energy (VRE)</a> sources like wind and solar, plus new technologies like large batteries (<a href="https://en.wikipedia.org/wiki/Grid_energy_storage" target="_blank">Energy Storage - ES</a>). At the same time, extreme weather events linked to climate change put more stress on the system.</p>
            <p>Planning the future grid is complex. We need enough power generation to meet demand reliably, even on the hottest or coldest days (this is called <a href="https://en.wikipedia.org/wiki/Resource_adequacy" target="_blank">Resource Adequacy</a>). We also want the power to be clean and affordable.</p>
            <p>In many parts of the world, including large areas of the U.S., the grid isn't planned centrally by a single entity. Instead, independent power companies, called <a href="https://en.wikipedia.org/wiki/Generating_company" target="_blank">Generating Companies (GenCos)</a>, decide whether to build new power plants or retire old ones based on whether they expect to make a profit. These decisions happen within complex <a href="https://en.wikipedia.org/wiki/Electricity_market" target="_blank">Wholesale Electricity Markets</a> run by <a href="https://en.wikipedia.org/wiki/Independent_system_operator" target="_blank">Independent System Operators (ISOs)</a> or <a href="https://en.wikipedia.org/wiki/Regional_transmission_organization_(North_America)" target="_blank">Regional Transmission Organizations (RTOs)</a>, who also manage grid reliability.</p>
            <p><strong>The core question this paper tackles is:</strong> How do the specific rules of these markets, and policies like clean energy incentives, influence GenCos' investment decisions, and ultimately, the reliability and cleanliness of our future power supply?</p>
        </section>

        <section>
            <h2>Two Ways to Plan: Least Cost vs. Strategic Profit</h2>
            <p>Traditionally, grid planners used models to find the cheapest way to build enough power plants to meet future demand reliably. This is the <strong>Least-Cost Generation Expansion Planning (LC-GEP)</strong> approach. It assumes a central planner optimizes the whole system for minimum cost.</p>

            <div class="interactive-section">
                <h3>Visualizing Least-Cost Planning (Simplified)</h3>
                <p>Imagine a planner needs to add 1000 MW of new capacity. They have options: Solar, Wind, and Gas, each with different costs. The goal is to meet the 1000 MW target at the lowest total cost.</p>
                <div class="row mb-3">
                    <div class="col-md-4">
                        <label for="solarCostSlider">Solar Cost ($/MW): <span id="solarCostValue" class="value-display">1000</span></label>
                        <input type="range" id="solarCostSlider" min="500" max="1500" value="1000" step="50">
                    </div>
                    <div class="col-md-4">
                        <label for="windCostSlider">Wind Cost ($/MW): <span id="windCostValue" class="value-display">1200</span></label>
                        <input type="range" id="windCostSlider" min="700" max="1700" value="1200" step="50">
                    </div>
                    <div class="col-md-4">
                        <label for="gasCostSlider">Gas Cost ($/MW): <span id="gasCostValue" class="value-display">800</span></label>
                        <input type="range" id="gasCostSlider" min="400" max="1200" value="800" step="50">
                    </div>
                </div>
                <div id="lc-gep-chart"></div>
                <p>Total Cost: $<span id="lc-gep-total-cost" class="value-display">800,000</span></p>
                <small>This is highly simplified. Real LC-GEP considers operating costs, fuel costs, reliability constraints (like Planning Reserve Margin), transmission, etc.</small>
            </div>

            <p>However, in deregulated markets, there's no single central planner making all investment decisions. Instead, multiple GenCos act strategically, aiming to maximize their <em>own</em> profits. They look at expected revenues from selling energy, capacity (if available), and potentially clean energy credits, and compare that to the cost of building and operating a plant.</p>
            <p>This paper uses a more complex model called the <strong>Strategic Capacity Investment Model (SCIM)</strong>. It simulates this competitive environment using game theory, specifically an <a href="https://en.wikipedia.org/wiki/Mathematical_program_with_equilibrium_constraints" target="_blank">Equilibrium Problem with Equilibrium Constraints (EPEC)</a>. The key idea is that each GenCo makes its best decision assuming what other GenCos will do, and the model finds a stable outcome (an equilibrium) where no GenCo wants to unilaterally change its strategy.</p>

            <div class="interactive-section">
                <h3>A GenCo's Investment Decision (Simplified)</h3>
                <p>Imagine you're a GenCo deciding whether to build a new 100 MW Solar plant. You estimate its lifetime cost and the potential revenue from selling energy in the market.</p>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="gencoPlantCostSlider">Plant Cost ($ Million): <span id="gencoPlantCostValue" class="value-display">100</span></label>
                        <input type="range" id="gencoPlantCostSlider" min="50" max="150" value="100" step="5">
                    </div>
                    <div class="col-md-6">
                        <label for="gencoRevenueSlider">Expected Lifetime Revenue ($ Million): <span id="gencoRevenueValue" class="value-display">110</span></label>
                        <input type="range" id="gencoRevenueSlider" min="50" max="150" value="110" step="5">
                    </div>
                </div>
                <p>Estimated Profit: $<span id="gencoProfitValue" class="value-display">10</span> Million</p>
                <p>Decision: <strong id="gencoDecision">Invest</strong></p>
                <small>This is extremely simplified. Real GenCos forecast complex market prices over decades, consider financing, risk, competitor actions, different revenue streams (energy, capacity, etc.), and operating costs.</small>
            </div>

            <p>Crucially, the collective outcome of these individual profit-driven decisions might be different from the system-wide least-cost solution. The SCIM allows researchers to explore these differences.</p>
        </section>

        <section>
            <h2>Market Designs: The Rules of the Game</h2>
            <p>The paper examines how different market structures influence GenCo decisions and system outcomes. It focuses on three main types:</p>

            <h3>1. Energy-Only (EO) Market</h3>
            <p>In the simplest design, GenCos only get paid for the actual energy ($MWh$) they produce and sell into the wholesale market. Prices can vary significantly, sometimes spiking very high during periods of scarcity (when demand is high and supply is tight). The theory is that these occasional high prices should provide enough revenue, even for plants that don't run often (like gas "peaker" plants needed for reliability), to cover their costs and incentivize investment.</p>

            <div class="interactive-section">
                <h4>Simulating Energy-Only Revenue</h4>
                <p>Can infrequent price spikes cover a plant's fixed costs? Let's simulate a year of hourly prices for a hypothetical peaking plant that costs $50,000/year to maintain (fixed cost) and only runs when prices are high.</p>
                <div class="row mb-3">
                     <div class="col-md-6">
                        <label for="eoPriceCapSlider">Energy Price Cap ($/MWh): <span id="eoPriceCapValue" class="value-display">1000</span></label>
                        <input type="range" id="eoPriceCapSlider" min="200" max="9000" value="1000" step="100">
                    </div>
                     <div class="col-md-6">
                        <label for="eoScarcityFreqSlider">Frequency of High Prices (% of hours > $100/MWh): <span id="eoScarcityFreqValue" class="value-display">1</span>%</label>
                        <input type="range" id="eoScarcityFreqSlider" min="0.1" max="5" value="1" step="0.1">
                    </div>
                </div>
                <button id="runEoSimButton" class="btn btn-primary mb-2">Run Simulation</button>
                <div id="eo-sim-chart" style="height: 200px; background-color: #eee; border: 1px solid #ccc; overflow: hidden; position: relative;">
                     <p style="text-align: center; padding-top: 80px;">Click 'Run Simulation' to see price spikes.</p>
                </div>
                 <p>Simulated Annual Energy Revenue: $<span id="eoRevenueValue" class="value-display">0</span></p>
                 <p>Plant Fixed Costs: $<span id="eoFixedCostValue" class="value-display">50,000</span></p>
                 <p>Net Result: <strong id="eoProfitResult">---</strong></p>
                <small>This simulation uses random price generation for illustration. Real prices depend on complex supply, demand, and grid conditions. The paper's "ORDC" refers to Operating Reserve Demand Curves which help shape scarcity prices.</small>
            </div>
            <p><strong>Finding from Paper:</strong> In SCIM simulations, Energy-Only markets often led to lower investment levels and lower <a href="https://www.nerc.com/pa/RAPA/ra/Resource%20Adequacy%20Guidance%20Documents%20DL/Primer_on_Planning_Reserve_Margins.pdf" target="_blank">Planning Reserve Margins (PRM)</a> - the buffer of extra capacity above peak demand - compared to what a least-cost planner would choose or what happens in markets with capacity payments. This suggests potential reliability concerns if solely relying on energy prices.</p>

            <h3>2. Capacity Market (CM)</h3>
            <p>To address potential under-investment in EO markets, many regions use Capacity Markets. Here, GenCos receive payments not just for energy produced, but for being <em>available</em> to produce power when needed, measured in capacity ($MW$). The ISO/RTO determines how much capacity the system needs to be reliable (often based on a target PRM) and runs an auction to procure it. The price is typically set where the supply of available capacity meets an administratively determined <a href="https://www.iso-ne.com/static-assets/documents/2018/02/a3_sloped_demand_curve_faq.pdf" target="_blank">Capacity Demand Curve</a>.</p>

            <div class="interactive-section">
                <h4>Visualizing a Capacity Auction (Simplified)</h4>
                <p>Generators offer their available capacity (derated by factors like outage probability or fuel limits, called "capacity credits"). The ISO has a demand curve representing the value of reliability. The intersection sets the clearing price and quantity.</p>
                <div class="row mb-3">
                    <div class="col-md-6">
                         <label for="cmDemandTargetSlider">Capacity Target (MW): <span id="cmDemandTargetValue" class="value-display">100000</span></label>
                         <input type="range" id="cmDemandTargetSlider" min="80000" max="120000" value="100000" step="1000">
                    </div>
                     <div class="col-md-6">
                         <label for="cmDemandSlopeSlider">Demand Curve Steepness: <span id="cmDemandSlopeValue" class="value-display">0.5</span></label>
                         <input type="range" id="cmDemandSlopeSlider" min="0.1" max="2.0" value="0.5" step="0.1"> (Higher = steeper)
                    </div>
                </div>
                <div id="cm-auction-chart"></div>
                <p>Cleared Capacity: <span id="cmClearedCapacity" class="value-display">0</span> MW</p>
                <p>Clearing Price: $<span id="cmClearingPrice" class="value-display">0</span> /MW-day (Illustrative)</p>
                <small>This uses a simplified linear supply curve and variable demand curve. Real auctions are complex. The paper explores different demand curve shapes (CM1, CM2, CM3) and capacity credit rules (Peak Av. Output, ELCC).</small>
            </div>
            <p><strong>Finding from Paper:</strong> Capacity markets, simulated in SCIM, generally resulted in PRMs closer to the target levels compared to EO markets. However, the <em>specific design</em> of the capacity market (e.g., shape of the demand curve) significantly influenced <em>which types</em> of power plants were built (e.g., favoring gas vs. solar depending on the curve).</p>

            <h3>3. Clean Energy Market (CEM)</h3>
            <p>This is a newer concept, explored in the paper, designed to directly incentivize clean energy generation. Similar to a capacity market, there's a target amount of clean energy attributes (like <a href="https://en.wikipedia.org/wiki/Renewable_Energy_Certificate_(United_States)" target="_blank">Renewable Energy Credits - RECs</a>) needed. Generators eligible (like wind, solar, nuclear, hydro in the paper's setup) offer their expected clean energy production, and an auction clears based on a demand curve reflecting the value of clean energy (e.g., related to the social cost of carbon or policy goals).</p>
            <div class="interactive-section">
                <h4>Visualizing a Clean Energy Market (Simplified)</h4>
                 <p>Eligible clean generators offer their expected annual clean MWh. The market operator has a demand curve for these clean attributes.</p>
                 <div class="row mb-3">
                     <div class="col-md-6">
                         <label for="cemTargetSlider">Clean Energy Target (% of Demand): <span id="cemTargetValue" class="value-display">50</span>%</label>
                         <input type="range" id="cemTargetSlider" min="20" max="80" value="50" step="5">
                     </div>
                     <div class="col-md-6">
                         <label for="cemPriceSlider">Reference Price ($/MWh Clean): <span id="cemPriceValue" class="value-display">1.3</span></label>
                         <input type="range" id="cemPriceSlider" min="0.5" max="5.0" value="1.3" step="0.1">
                     </div>
                 </div>
                 <div id="cem-auction-chart"></div>
                 <p>Cleared Clean Energy: <span id="cemClearedAmount" class="value-display">0</span> %</p>
                 <p>Clearing Price: $<span id="cemClearingPrice" class="value-display">0</span> /MWh (Illustrative)</p>
                 <small>This is a conceptual illustration. The paper models a specific downward-sloping demand curve based on Brattle Group proposals.</small>
            </div>
             <p><strong>Finding from Paper:</strong> Adding a CEM promoted more investment in wind, solar, and storage compared to not having one, especially when combined with a capacity market. However, at the reference price used ($1.30/MWh), its impact in the energy-only market setting was minimal, suggesting the price signal might need to be stronger or combined with other mechanisms.</p>
        </section>

        <section>
            <h2>Policy Levers: Tax Credits and Carbon Pricing</h2>
            <p>Beyond market structure, specific policies also influence investment:</p>
            <ul>
                <li><strong>Tax Credits (TC):</strong> Subsidies for specific technologies (like Investment Tax Credits - ITC for solar, or Production Tax Credits - PTC for wind) directly reduce their costs, making them more attractive to GenCos.</li>
                <li><strong>Carbon Pricing (CP):</strong> Making generators pay for their carbon emissions (e.g., a price per ton of CO2) increases the operating cost of fossil fuel plants (coal, gas), making cleaner alternatives relatively more competitive.</li>
            </ul>
            <div class="interactive-section">
                <h4>Impact of Policies on Investment Choice (Simplified)</h4>
                <p>A GenCo compares building a new Gas plant vs. a Wind plant. Adjust the policy levels to see how the relative profitability changes.</p>
                <p><strong>Baseline Costs/Revenues (Illustrative):</strong><br>
                   Gas Plant: Cost $80M, Revenue $90M (Profit +$10M)<br>
                   Wind Plant: Cost $120M, Revenue $125M (Profit +$5M)
                </p>
                 <div class="row mb-3">
                     <div class="col-md-6">
                         <label for="policyTcSlider">Wind Production Tax Credit ($/MWh): <span id="policyTcValue" class="value-display">0</span></label>
                         <input type="range" id="policyTcSlider" min="0" max="30" value="0" step="1"> (Adds to Wind Revenue)
                     </div>
                     <div class="col-md-6">
                         <label for="policyCpSlider">Carbon Price ($/ton CO2): <span id="policyCpValue" class="value-display">0</span></label>
                         <input type="range" id="policyCpSlider" min="0" max="100" value="0" step="5"> (Reduces Gas Revenue)
                     </div>
                 </div>
                 <p><strong>Adjusted Profitability:</strong><br>
                   Gas Plant Profit: $<span id="policyGasProfit" class="value-display">10</span>M<br>
                   Wind Plant Profit: $<span id="policyWindProfit" class="value-display">5</span>M
                 </p>
                 <p>More Profitable Option: <strong id="policyDecision">Gas Plant</strong></p>
                 <small>Assumes $15/MWh PTC adds ~$5M revenue, $40/ton CP reduces Gas revenue by ~$8M in this example.</small>
            </div>
            <p><strong>Finding from Paper:</strong> Both tax credits and carbon pricing significantly shifted investments towards cleaner resources in the SCIM simulations. Carbon pricing, by changing the relative operating costs, had a broad impact on which plants run and when, leading to substantial increases in renewables and storage, and higher PRMs in the EO case. Tax credits also boosted renewables but had less impact on retiring existing fossil plants.</p>
        </section>

        <section>
            <h2>Key Findings: Market Design Matters!</h2>
            <p>The paper's core message is that the rules of the electricity market profoundly impact investment decisions and grid outcomes. Here are some key takeaways visualized:</p>

            <div class="interactive-section">
                <h3>Comparing Outcomes: SCIM vs. LC-GEP (Simplified)</h3>
                <p>Let's compare the resulting generation mix and reliability (PRM) under different scenarios from the profit-driven SCIM model versus the idealized Least-Cost (LC-GEP) model. Select scenarios to compare.</p>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="scenarioSelect1">Scenario 1:</label>
                        <select id="scenarioSelect1" class="form-select">
                            <option value="EO_SCIM">Energy Only (SCIM)</option>
                            <option value="EO_LCGEP">Energy Only (LC-GEP)</option>
                            <option value="CM_SCIM">Capacity Market (SCIM)</option>
                            <option value="CM_LCGEP">Capacity Market (LC-GEP)</option>
                            <option value="CP_SCIM">Carbon Price (SCIM)</option>
                            <option value="CP_LCGEP">Carbon Price (LC-GEP)</option>
                        </select>
                    </div>
                     <div class="col-md-6">
                        <label for="scenarioSelect2">Scenario 2:</label>
                        <select id="scenarioSelect2" class="form-select">
                            <option value="EO_LCGEP">Energy Only (LC-GEP)</option>
                            <option value="EO_SCIM">Energy Only (SCIM)</option>
                            <option value="CM_SCIM">Capacity Market (SCIM)</option>
                            <option value="CM_LCGEP">Capacity Market (LC-GEP)</option>
                            <option value="CP_SCIM">Carbon Price (SCIM)</option>
                            <option value="CP_LCGEP">Carbon Price (LC-GEP)</option>
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <h4>Scenario 1: <span id="resultsScenario1Name"></span></h4>
                        <div id="results-chart1"></div>
                        <p>Planning Reserve Margin (PRM): <span id="resultsPRM1" class="value-display highlight">0</span>%</p>
                    </div>
                     <div class="col-md-6">
                        <h4>Scenario 2: <span id="resultsScenario2Name"></span></h4>
                        <div id="results-chart2"></div>
                         <p>Planning Reserve Margin (PRM): <span id="resultsPRM2" class="value-display highlight">0</span>%</p>
                    </div>
                </div>
                 <div id="results-legend" class="mt-3">
                    <strong>Legend:</strong>
                    <span class="legend-color tech-wind"></span><span class="legend-label">Wind</span>
                    <span class="legend-color tech-solar"></span><span class="legend-label">Solar</span>
                    <span class="legend-color tech-storage"></span><span class="legend-label">Storage</span>
                    <span class="legend-color tech-gas"></span><span class="legend-label">Gas</span>
                    <span class="legend-color tech-other"></span><span class="legend-label">Other (Existing)</span>
                 </div>
                <small>Data is illustrative, based qualitatively on Fig 7 & 8 trends. Shows <em>new</em> capacity additions plus existing capacity. Other includes Coal, Nuclear, Hydro etc. PRM values are indicative.</small>
            </div>

            <ul>
                <li><strong>Profit vs. Cost Optimization:</strong> The SCIM (profit-driven) results often differed significantly from the LC-GEP (least-cost) results, especially in Energy-Only markets where SCIM led to lower reliability (PRM). This highlights that what's optimal for individual companies might not be optimal for the system as a whole without the right market signals.</li>
                <li><strong>Energy-Only Risks:</strong> EO markets appeared prone to under-investment and lower reliability in the strategic model, suggesting that relying solely on energy price spikes might be insufficient.</li>
                <li><strong>Capacity Market Benefits & Nuances:</strong> CMs helped align investment with reliability targets. However, details like the demand curve shape dramatically affected the technology mix, showing the importance of careful design.</li>
                <li><strong>Policy Effectiveness:</strong> Carbon pricing and tax credits effectively steered investment toward clean energy, but through different mechanisms, impacting the final mix and retirement of fossil fuels differently.</li>
                <li><strong>Clean Energy Markets:</strong> CEMs show potential but may need sufficiently strong price signals or integration with other market mechanisms to drive large-scale investment.</li>
            </ul>
        </section>

        <section>
            <h2>Conclusion: Designing for the Future</h2>
            <p>This research underscores the critical importance of well-designed electricity markets and policies for navigating the transition to a reliable, clean, and affordable power system. Key takeaways include:</p>
            <ul>
                <li>Modeling the strategic behavior of profit-seeking GenCos is crucial, as their decisions can diverge from traditional least-cost planning outcomes.</li>
                <li>Market designs are not neutral; they create specific incentives that favor certain technologies and influence overall system reliability.</li>
                <li>Energy-Only markets may carry risks of under-investment without robust scarcity pricing mechanisms.</li>
                <li>Capacity Markets can enhance reliability but require careful design regarding demand curves and capacity credits.</li>
                <li>Clean energy incentives like carbon pricing, tax credits, and potentially CEMs are powerful tools but have distinct impacts.</li>
            </ul>
            <p>The paper uses sophisticated modeling (EPEC solved with diagonalization and progressive hedging) to capture these complex interactions. While this interactive exploration simplifies many details, it aims to convey the fundamental insight: the rules we set for our electricity markets will play a major role in shaping our energy future.</p>
        </section>

        <footer class="mt-5 text-muted">
            <hr>
            <p><small>This interactive page is an interpretation of the research paper by Kwon et al. (2023) and aims for educational clarity. It simplifies complex models and results. Refer to the original paper for full details and methodology. Interactive elements use illustrative data. Created using Bootstrap, D3.js, and MathJax.</small></p>
        </footer>

    </div> <!-- /container -->

    <!-- Inline Javascript -->
    <script>
        // --- Interactive Element: LC-GEP Chart ---
        const solarCostSlider = document.getElementById('solarCostSlider');
        const windCostSlider = document.getElementById('windCostSlider');
        const gasCostSlider = document.getElementById('gasCostSlider');
        const solarCostValue = document.getElementById('solarCostValue');
        const windCostValue = document.getElementById('windCostValue');
        const gasCostValue = document.getElementById('gasCostValue');
        const lcGepTotalCost = document.getElementById('lc-gep-total-cost');
        const lcGepChartDiv = document.getElementById('lc-gep-chart');

        // D3 setup for LC-GEP Chart
        const lcGepMargin = {top: 10, right: 10, bottom: 20, left: 40};
        const lcGepWidth = lcGepChartDiv.clientWidth ? lcGepChartDiv.clientWidth - lcGepMargin.left - lcGepMargin.right : 300;
        const lcGepHeight = 150 - lcGepMargin.top - lcGepMargin.bottom;

        const lcGepSvg = d3.select("#lc-gep-chart").append("svg")
            .attr("width", lcGepWidth + lcGepMargin.left + lcGepMargin.right)
            .attr("height", lcGepHeight + lcGepMargin.top + lcGepMargin.bottom)
          .append("g")
            .attr("transform", `translate(${lcGepMargin.left},${lcGepMargin.top})`);

        const lcGepX = d3.scaleBand().range([0, lcGepWidth]).padding(0.1);
        const lcGepY = d3.scaleLinear().range([lcGepHeight, 0]);

        lcGepSvg.append("g")
          .attr("class", "axis axis--x")
          .attr("transform", `translate(0,${lcGepHeight})`);

        lcGepSvg.append("g")
          .attr("class", "axis axis--y");

        function updateLcGePChart() {
            const costs = [
                { tech: 'Solar', cost: parseInt(solarCostSlider.value) },
                { tech: 'Wind', cost: parseInt(windCostSlider.value) },
                { tech: 'Gas', cost: parseInt(gasCostSlider.value) }
            ];
            solarCostValue.textContent = solarCostSlider.value;
            windCostValue.textContent = windCostSlider.value;
            gasCostValue.textContent = gasCostSlider.value;

            // Simple logic: build 1000 MW of the cheapest option
            costs.sort((a, b) => a.cost - b.cost);
            const cheapestTech = costs[0].tech;
            const cheapestCost = costs[0].cost;
            const capacity = 1000; // MW target

            const data = [
                { tech: 'Solar', capacity: cheapestTech === 'Solar' ? capacity : 0 },
                { tech: 'Wind', capacity: cheapestTech === 'Wind' ? capacity : 0 },
                { tech: 'Gas', capacity: cheapestTech === 'Gas' ? capacity : 0 }
            ];

            const totalCost = cheapestCost * capacity;
            lcGepTotalCost.textContent = totalCost.toLocaleString();

            // Update D3 chart
            lcGepX.domain(data.map(d => d.tech));
            lcGepY.domain([0, d3.max(data, d => d.capacity) || capacity]); // Ensure y-axis covers target

            lcGepSvg.select(".axis--x").call(d3.axisBottom(lcGepX));
            lcGepSvg.select(".axis--y").call(d3.axisLeft(lcGepY).ticks(5));

            const bars = lcGepSvg.selectAll(".bar").data(data, d => d.tech);

            bars.enter().append("rect")
              .attr("class", "bar")
              .attr("x", d => lcGepX(d.tech))
              .attr("width", lcGepX.bandwidth())
              .attr("y", d => lcGepY(d.capacity))
              .attr("height", d => lcGepHeight - lcGepY(d.capacity))
              .merge(bars)
              .transition().duration(300)
              .attr("x", d => lcGepX(d.tech))
              .attr("width", lcGepX.bandwidth())
              .attr("y", d => lcGepY(d.capacity))
              .attr("height", d => lcGepHeight - lcGepY(d.capacity));

            bars.exit().remove();
        }

        solarCostSlider.addEventListener('input', updateLcGePChart);
        windCostSlider.addEventListener('input', updateLcGePChart);
        gasCostSlider.addEventListener('input', updateLcGePChart);
        updateLcGePChart(); // Initial call

        // --- Interactive Element: GenCo Investment Decision ---
        const gencoPlantCostSlider = document.getElementById('gencoPlantCostSlider');
        const gencoRevenueSlider = document.getElementById('gencoRevenueSlider');
        const gencoPlantCostValue = document.getElementById('gencoPlantCostValue');
        const gencoRevenueValue = document.getElementById('gencoRevenueValue');
        const gencoProfitValue = document.getElementById('gencoProfitValue');
        const gencoDecision = document.getElementById('gencoDecision');

        function updateGencoDecision() {
            const cost = parseInt(gencoPlantCostSlider.value);
            const revenue = parseInt(gencoRevenueSlider.value);
            const profit = revenue - cost;

            gencoPlantCostValue.textContent = cost;
            gencoRevenueValue.textContent = revenue;
            gencoProfitValue.textContent = profit;

            if (profit > 0) {
                gencoDecision.textContent = "Invest";
                gencoDecision.style.color = "green";
            } else {
                gencoDecision.textContent = "Do Not Invest";
                gencoDecision.style.color = "red";
            }
        }

        gencoPlantCostSlider.addEventListener('input', updateGencoDecision);
        gencoRevenueSlider.addEventListener('input', updateGencoDecision);
        updateGencoDecision(); // Initial call


        // --- Interactive Element: Energy Only Simulation ---
        const eoPriceCapSlider = document.getElementById('eoPriceCapSlider');
        const eoScarcityFreqSlider = document.getElementById('eoScarcityFreqSlider');
        const eoPriceCapValue = document.getElementById('eoPriceCapValue');
        const eoScarcityFreqValue = document.getElementById('eoScarcityFreqValue');
        const runEoSimButton = document.getElementById('runEoSimButton');
        const eoSimChartDiv = document.getElementById('eo-sim-chart');
        const eoRevenueValue = document.getElementById('eoRevenueValue');
        const eoFixedCostValue = document.getElementById('eoFixedCostValue');
        const eoProfitResult = document.getElementById('eoProfitResult');
        const plantFixedCost = 50000;
        eoFixedCostValue.textContent = plantFixedCost.toLocaleString();

        function runEoSimulation() {
            const priceCap = parseFloat(eoPriceCapSlider.value);
            const scarcityFreq = parseFloat(eoScarcityFreqSlider.value) / 100; // Convert percentage to fraction
            const hoursInYear = 8760;
            const plantCapacity = 10; // Assume a small 10 MW peaker
            const scarcityThreshold = 100; // $/MWh
            let totalRevenue = 0;
            let priceData = [];

            for (let i = 0; i < hoursInYear; i++) {
                let price = Math.random() * 50; // Base price
                if (Math.random() < scarcityFreq) {
                    // Generate a high price, potentially up to the cap
                    price = scarcityThreshold + Math.random() * (priceCap - scarcityThreshold);
                }
                 // Assume plant runs if price > threshold
                if (price > scarcityThreshold) {
                    totalRevenue += price * plantCapacity; // Revenue = Price * Energy (Capacity * 1 hour)
                }
                // Store limited data for plotting
                if (i % 50 == 0) { // Sample data points for plotting
                    priceData.push({hour: i, price: price});
                }
            }

            eoRevenueValue.textContent = Math.round(totalRevenue).toLocaleString();
            const netProfit = totalRevenue - plantFixedCost;
            if (netProfit > 0) {
                eoProfitResult.textContent = `Profitable ($${Math.round(netProfit).toLocaleString()})`;
                eoProfitResult.style.color = "green";
            } else {
                 eoProfitResult.textContent = `Not Profitable ($${Math.round(netProfit).toLocaleString()})`;
                eoProfitResult.style.color = "red";
            }

            // --- Basic Visualization of Price Spikes ---
            eoSimChartDiv.innerHTML = ''; // Clear previous plot
            const eoPlotWidth = eoSimChartDiv.clientWidth;
            const eoPlotHeight = eoSimChartDiv.clientHeight;
            const eoPlotSvg = d3.select("#eo-sim-chart").append("svg")
                .attr("width", eoPlotWidth)
                .attr("height", eoPlotHeight);

             const eoPlotX = d3.scaleLinear().domain([0, hoursInYear]).range([0, eoPlotWidth]);
             const eoPlotY = d3.scaleLinear().domain([0, priceCap]).range([eoPlotHeight, 0]); // Y axis up to price cap

             // Draw price spikes as vertical lines
             eoPlotSvg.selectAll("line")
               .data(priceData.filter(d => d.price > scarcityThreshold))
               .enter().append("line")
               .attr("x1", d => eoPlotX(d.hour))
               .attr("y1", eoPlotHeight)
               .attr("x2", d => eoPlotX(d.hour))
               .attr("y2", d => eoPlotY(d.price))
               .attr("stroke", "red")
               .attr("stroke-width", 1);

            // Add a baseline
            eoPlotSvg.append("line")
                .attr("x1", 0).attr("y1", eoPlotY(50)) // Example baseline
                .attr("x2", eoPlotWidth).attr("y2", eoPlotY(50))
                .attr("stroke", "grey").attr("stroke-dasharray", "2,2");
        }

        eoPriceCapSlider.addEventListener('input', () => { eoPriceCapValue.textContent = eoPriceCapSlider.value; });
        eoScarcityFreqSlider.addEventListener('input', () => { eoScarcityFreqValue.textContent = eoScarcityFreqSlider.value; });
        runEoSimButton.addEventListener('click', runEoSimulation);


        // --- Interactive Element: Capacity Market Auction ---
        const cmDemandTargetSlider = document.getElementById('cmDemandTargetSlider');
        const cmDemandSlopeSlider = document.getElementById('cmDemandSlopeSlider');
        const cmDemandTargetValue = document.getElementById('cmDemandTargetValue');
        const cmDemandSlopeValue = document.getElementById('cmDemandSlopeValue');
        const cmAuctionChartDiv = document.getElementById('cm-auction-chart');
        const cmClearedCapacity = document.getElementById('cmClearedCapacity');
        const cmClearingPrice = document.getElementById('cmClearingPrice');

        const cmMargin = {top: 10, right: 10, bottom: 30, left: 40};
        const cmWidth = cmAuctionChartDiv.clientWidth ? cmAuctionChartDiv.clientWidth - cmMargin.left - cmMargin.right : 400;
        const cmHeight = 200 - cmMargin.top - cmMargin.bottom;

        const cmSvg = d3.select("#cm-auction-chart").append("svg")
            .attr("width", cmWidth + cmMargin.left + cmMargin.right)
            .attr("height", cmHeight + cmMargin.top + cmMargin.bottom)
          .append("g")
            .attr("transform", `translate(${cmMargin.left},${cmMargin.top})`);

        const cmX = d3.scaleLinear().range([0, cmWidth]);
        const cmY = d3.scaleLinear().range([cmHeight, 0]); // Price axis

        cmSvg.append("g")
          .attr("class", "axis axis--x-cm")
          .attr("transform", `translate(0,${cmHeight})`)
          .append("text")
            .attr("fill", "#000")
            .attr("x", cmWidth / 2)
            .attr("y", 25)
            .attr("text-anchor", "middle")
            .text("Capacity (MW)");


        cmSvg.append("g")
          .attr("class", "axis axis--y-cm")
           .append("text")
            .attr("fill", "#000")
            .attr("transform", "rotate(-90)")
            .attr("y", -30)
            .attr("x", -cmHeight / 2)
            .attr("text-anchor", "middle")
            .text("Price ($/MW-day)");

        const cmSupplyLine = cmSvg.append("line").attr("stroke", "steelblue").attr("stroke-width", 2);
        const cmDemandLine = cmSvg.append("line").attr("stroke", "darkorange").attr("stroke-width", 2);
        const cmIntersectionPoint = cmSvg.append("circle").attr("r", 4).attr("fill", "red");
        const cmHLine = cmSvg.append("line").attr("stroke", "red").attr("stroke-width", 1).attr("stroke-dasharray", "2,2");
        const cmVLine = cmSvg.append("line").attr("stroke", "red").attr("stroke-width", 1).attr("stroke-dasharray", "2,2");

        function updateCmAuctionChart() {
            const targetCap = parseInt(cmDemandTargetSlider.value);
            const slopeFactor = parseFloat(cmDemandSlopeSlider.value);
            cmDemandTargetValue.textContent = targetCap.toLocaleString();
            cmDemandSlopeValue.textContent = slopeFactor;

            // Simplified supply curve: Assume vertical at some available capacity
            const availableSupply = 110000; // Example total supply slightly > target
            const maxPrice = 200; // Example max price for axis scaling

            // Simplified demand curve: P = MaxP * (1 - slope * (Q - Target) / Target)
            // This is just one way to model it; the paper implies more complex curves (like Net CONE based)
            const demandCurve = (q) => Math.max(0, maxPrice * (1 - slopeFactor * (q - targetCap) / targetCap));
             // Simplified supply: Vertical line at availableSupply
            const supplyCurve = (q) => (q <= availableSupply ? 0 : maxPrice * 10); // Effectively vertical

            // Find intersection (simplified: where demand price equals ~0 at available supply, or where supply hits demand curve if supply < target)
            // For this simple vertical supply, the quantity is fixed at availableSupply (if demand price > 0)
            // and the price is determined by the demand curve at that quantity.
            let clearedQty = Math.min(availableSupply, 125000); // Limit clearing
            let clearedPrice = demandCurve(clearedQty);

            // Adjust cleared Qty if price is 0 on demand curve
             if (clearedPrice <=0) {
                 // find Q where demand hits 0
                 clearedQty = targetCap * (1 + 1/slopeFactor);
                 clearedPrice = 0;
             }
             clearedQty = Math.min(clearedQty, availableSupply); // Cannot clear more than available
             clearedPrice = demandCurve(clearedQty); // Recalculate price at potentially limited Qty


            cmClearedCapacity.textContent = Math.round(clearedQty).toLocaleString();
            cmClearingPrice.textContent = clearedPrice.toFixed(2);

            // Update D3 chart
            const maxX = 125000; // Set axis limit
            cmX.domain([75000, maxX]);
            cmY.domain([0, maxPrice * 1.1]);

            cmSvg.select(".axis--x-cm").call(d3.axisBottom(cmX).ticks(5).tickFormat(d3.format(".2s")));
            cmSvg.select(".axis--y-cm").call(d3.axisLeft(cmY));

            // Draw Supply (Vertical Line)
            cmSupplyLine
                .attr("x1", cmX(availableSupply))
                .attr("y1", cmY(0))
                .attr("x2", cmX(availableSupply))
                .attr("y2", cmY(maxPrice * 1.1));

            // Draw Demand Curve (as a line segment for simplicity)
            const qDemandStart = cmX.domain()[0];
            const qDemandEnd = cmX.domain()[1];
            cmDemandLine
                .attr("x1", cmX(qDemandStart))
                .attr("y1", cmY(demandCurve(qDemandStart)))
                .attr("x2", cmX(qDemandEnd))
                .attr("y2", cmY(demandCurve(qDemandEnd)));

            // Intersection point and lines
             cmIntersectionPoint.attr("cx", cmX(clearedQty)).attr("cy", cmY(clearedPrice));
             cmHLine.attr("x1", 0).attr("y1", cmY(clearedPrice)).attr("x2", cmX(clearedQty)).attr("y2", cmY(clearedPrice));
             cmVLine.attr("x1", cmX(clearedQty)).attr("y1", cmHeight).attr("x2", cmX(clearedQty)).attr("y2", cmY(clearedPrice));

        }

        cmDemandTargetSlider.addEventListener('input', updateCmAuctionChart);
        cmDemandSlopeSlider.addEventListener('input', updateCmAuctionChart);
        updateCmAuctionChart(); // Initial call


        // --- Interactive Element: Clean Energy Market ---
        // (Similar structure to Capacity Market, modify parameters and labels)
        const cemTargetSlider = document.getElementById('cemTargetSlider');
        const cemPriceSlider = document.getElementById('cemPriceSlider');
        const cemTargetValue = document.getElementById('cemTargetValue');
        const cemPriceValue = document.getElementById('cemPriceValue');
        const cemAuctionChartDiv = document.getElementById('cem-auction-chart');
        const cemClearedAmount = document.getElementById('cemClearedAmount');
        const cemClearingPrice = document.getElementById('cemClearingPrice');

        const cemMargin = {top: 10, right: 10, bottom: 30, left: 40};
        const cemWidth = cemAuctionChartDiv.clientWidth ? cemAuctionChartDiv.clientWidth - cemMargin.left - cemMargin.right : 400;
        const cemHeight = 200 - cemMargin.top - cemMargin.bottom;

        const cemSvg = d3.select("#cem-auction-chart").append("svg")
            .attr("width", cemWidth + cemMargin.left + cemMargin.right)
            .attr("height", cemHeight + cemMargin.top + cemMargin.bottom)
          .append("g")
            .attr("transform", `translate(${cemMargin.left},${cemMargin.top})`);

        const cemX = d3.scaleLinear().range([0, cemWidth]); // % of demand
        const cemY = d3.scaleLinear().range([cemHeight, 0]); // Price axis

        cemSvg.append("g")
          .attr("class", "axis axis--x-cem")
          .attr("transform", `translate(0,${cemHeight})`)
           .append("text")
            .attr("fill", "#000")
            .attr("x", cemWidth / 2)
            .attr("y", 25)
            .attr("text-anchor", "middle")
            .text("Clean Energy (% Demand)");

        cemSvg.append("g")
          .attr("class", "axis axis--y-cem")
           .append("text")
            .attr("fill", "#000")
            .attr("transform", "rotate(-90)")
            .attr("y", -30)
            .attr("x", -cemHeight / 2)
            .attr("text-anchor", "middle")
            .text("Price ($/MWh)");

        const cemSupplyLine = cemSvg.append("line").attr("stroke", "steelblue").attr("stroke-width", 2);
        const cemDemandPath = cemSvg.append("path").attr("stroke", "darkorange").attr("stroke-width", 2).attr("fill", "none");
        const cemIntersectionPoint = cemSvg.append("circle").attr("r", 4).attr("fill", "red");
        const cemHLine = cemSvg.append("line").attr("stroke", "red").attr("stroke-width", 1).attr("stroke-dasharray", "2,2");
        const cemVLine = cemSvg.append("line").attr("stroke", "red").attr("stroke-width", 1).attr("stroke-dasharray", "2,2");


        function updateCemAuctionChart() {
            const targetPercent = parseInt(cemTargetSlider.value);
            const refPrice = parseFloat(cemPriceSlider.value);
            cemTargetValue.textContent = targetPercent;
            cemPriceValue.textContent = refPrice.toFixed(1);

            // Simplified Supply: Assume upward sloping (more clean energy costs more)
            const availableCleanSupplyPercent = 60; // Example max potential
            const supplyCurve = (price) => Math.min(availableCleanSupplyPercent, 10 + price * 15); // Example linear supply

            // Demand Curve based on paper description (Fig 6): Sloped around target
            const demandWidthPercent = 0.2 / 100; // 0.2% width from paper
            const priceMultiplier = 1.5; // 1.5* Ref Price at top step
            const demandCurve = (percent) => {
                const q = percent / 100; // Convert back to fraction
                const targetQ = targetPercent / 100;
                if (q < targetQ - demandWidthPercent) return refPrice * priceMultiplier;
                if (q > targetQ + demandWidthPercent) return 0; // Assume price drops off quickly
                // Linear slope in between
                return refPrice * priceMultiplier - ( (q - (targetQ - demandWidthPercent)) / (2 * demandWidthPercent) ) * (refPrice * priceMultiplier) ;
            };

            // Find intersection by iterating (simple approach)
            let clearedPct = 0;
            let clearedPriceCem = 0;
            for (let p = 0; p < refPrice * priceMultiplier * 1.1; p += 0.01) {
                 let supplyPct = supplyCurve(p);
                 let demandPrice = demandCurve(supplyPct);
                 if (demandPrice <= p) { // Supply price meets or exceeds demand value
                     clearedPriceCem = p;
                     clearedPct = supplyPct;
                     break;
                 }
                 clearedPriceCem = p; // Keep track in case loop finishes
                 clearedPct = supplyPct;
            }
             clearedPct = Math.min(clearedPct, availableCleanSupplyPercent); // Cannot clear more than available
             clearedPriceCem = demandCurve(clearedPct); // Price is set by demand at cleared quantity


            cemClearedAmount.textContent = clearedPct.toFixed(1);
            cemClearingPrice.textContent = clearedPriceCem.toFixed(2);

            // Update D3 chart
            const maxX = 100; // %
            const maxY = refPrice * priceMultiplier * 1.2;
            cemX.domain([0, maxX]);
            cemY.domain([0, maxY]);

            cemSvg.select(".axis--x-cem").call(d3.axisBottom(cemX));
            cemSvg.select(".axis--y-cem").call(d3.axisLeft(cemY));

            // Draw Supply Curve
             const supplyPoints = d3.range(0, maxY, maxY/20).map(p => ({percent: supplyCurve(p), price: p}));
             const cemSupplyGenerator = d3.line()
                .x(d => cemX(d.percent))
                .y(d => cemY(d.price));
             cemSupplyLine.attr("d", cemSupplyGenerator(supplyPoints.filter(d => d.percent <= availableCleanSupplyPercent))); // Draw as path now

            // Draw Demand Curve
             const demandPoints = d3.range(0, maxX, 1).map(pct => ({percent: pct, price: demandCurve(pct)}));
             const cemDemandGenerator = d3.line()
                 .x(d => cemX(d.percent))
                 .y(d => cemY(d.price));
             cemDemandPath.attr("d", cemDemandGenerator(demandPoints));


            // Intersection point and lines
             cemIntersectionPoint.attr("cx", cemX(clearedPct)).attr("cy", cemY(clearedPriceCem));
             cemHLine.attr("x1", 0).attr("y1", cemY(clearedPriceCem)).attr("x2", cemX(clearedPct)).attr("y2", cemY(clearedPriceCem));
             cemVLine.attr("x1", cemX(clearedPct)).attr("y1", cemHeight).attr("x2", cemX(clearedPct)).attr("y2", cemY(clearedPriceCem));

        }
        cemTargetSlider.addEventListener('input', updateCemAuctionChart);
        cemPriceSlider.addEventListener('input', updateCemAuctionChart);
        updateCemAuctionChart(); // Initial call


        // --- Interactive Element: Policy Levers ---
        const policyTcSlider = document.getElementById('policyTcSlider');
        const policyCpSlider = document.getElementById('policyCpSlider');
        const policyTcValue = document.getElementById('policyTcValue');
        const policyCpValue = document.getElementById('policyCpValue');
        const policyGasProfit = document.getElementById('policyGasProfit');
        const policyWindProfit = document.getElementById('policyWindProfit');
        const policyDecision = document.getElementById('policyDecision');

        const baseGasCost = 80, baseGasRevenue = 90;
        const baseWindCost = 120, baseWindRevenue = 125;

        function updatePolicyImpact() {
            const ptc = parseFloat(policyTcSlider.value);
            const carbonPrice = parseFloat(policyCpSlider.value);
            policyTcValue.textContent = ptc;
            policyCpValue.textContent = carbonPrice;

            // Simplified impacts
            const windRevenueBoost = ptc * 0.16; // Assume $15/MWh PTC adds $5M total (adjust multiplier)
            const gasRevenuePenalty = carbonPrice * 0.2; // Assume $40/ton CP reduces revenue by $8M (adjust multiplier)

            const adjustedWindRevenue = baseWindRevenue + windRevenueBoost;
            const adjustedGasRevenue = baseGasRevenue - gasRevenuePenalty;

            const windProfit = adjustedWindRevenue - baseWindCost;
            const gasProfit = adjustedGasRevenue - baseGasCost;

            policyWindProfit.textContent = windProfit.toFixed(1);
            policyGasProfit.textContent = gasProfit.toFixed(1);

            if (windProfit > gasProfit) {
                policyDecision.textContent = "Wind Plant";
                policyDecision.style.color = "green";
            } else if (gasProfit > windProfit) {
                policyDecision.textContent = "Gas Plant";
                policyDecision.style.color = "#6c757d"; // Grey
            } else {
                 policyDecision.textContent = "Indifferent";
                 policyDecision.style.color = "orange";
            }
        }
        policyTcSlider.addEventListener('input', updatePolicyImpact);
        policyCpSlider.addEventListener('input', updatePolicyImpact);
        updatePolicyImpact();


        // --- Interactive Element: Results Comparison ---
         const scenarioSelect1 = document.getElementById('scenarioSelect1');
         const scenarioSelect2 = document.getElementById('scenarioSelect2');
         const resultsChart1Div = document.getElementById('results-chart1');
         const resultsChart2Div = document.getElementById('results-chart2');
         const resultsPRM1 = document.getElementById('resultsPRM1');
         const resultsPRM2 = document.getElementById('resultsPRM2');
         const resultsScenario1Name = document.getElementById('resultsScenario1Name');
         const resultsScenario2Name = document.getElementById('resultsScenario2Name');

        // Simplified illustrative data based on paper trends (Figs 7, 8, Table 4)
        // Values represent total unforced capacity (GW) for key types
        const resultsData = {
            "EO_SCIM":  { name: "Energy Only (SCIM)", prm: 3.7, mix: { Wind: 35+0.3, Solar: 11+1.8, Storage: 1.7+0.3, Gas: 20+0, Other: 50 } },
            "EO_LCGEP": { name: "Energy Only (LC-GEP)", prm: 8.6, mix: { Wind: 35+0, Solar: 11+5.5, Storage: 1.7+0, Gas: 20+0.9, Other: 50 } },
            "CM_SCIM":  { name: "Capacity Market (SCIM)", prm: 12.1, mix: { Wind: 35+0.4, Solar: 11+6.6, Storage: 1.7+0.3, Gas: 20+1.1, Other: 50 } }, // CM1-OR1
            "CM_LCGEP": { name: "Capacity Market (LC-GEP)", prm: 12.5, mix: { Wind: 35+0, Solar: 11+9.6, Storage: 1.7+0, Gas: 20+0, Other: 50 } }, // CM1-OR1
            "CP_SCIM":  { name: "Carbon Price (SCIM)", prm: 10.9, mix: { Wind: 35+1.5, Solar: 11+6.2, Storage: 1.7+0.6, Gas: 20+0, Other: 50 } }, // EO-OR3-CP
            "CP_LCGEP": { name: "Carbon Price (LC-GEP)", prm: 24.2, mix: { Wind: 35+3.5, Solar: 11+15.5, Storage: 1.7+0, Gas: 20+0, Other: 50 } }, // EO-OR3-CP
        };
        const techOrder = ["Other", "Gas", "Storage", "Solar", "Wind"]; // Order for stacked bars
        const techColors = { Wind: "tech-wind", Solar: "tech-solar", Storage: "tech-storage", Gas: "tech-gas", Other: "tech-other" };

        const resultsMargin = {top: 10, right: 10, bottom: 20, left: 40};
        const resultsWidth = resultsChart1Div.clientWidth ? resultsChart1Div.clientWidth - resultsMargin.left - resultsMargin.right : 300;
        const resultsHeight = 200 - resultsMargin.top - resultsMargin.bottom;

        const resultsY = d3.scaleLinear().range([resultsHeight, 0]);
        const resultsX = d3.scaleBand().domain(["Mix"]).range([0, resultsWidth]).padding(0.4); // Single "bar"

        function createResultsChart(containerId) {
             const svg = d3.select(`#${containerId}`).append("svg")
                 .attr("width", resultsWidth + resultsMargin.left + resultsMargin.right)
                 .attr("height", resultsHeight + resultsMargin.top + resultsMargin.bottom)
               .append("g")
                 .attr("transform", `translate(${resultsMargin.left},${resultsMargin.top})`);

             svg.append("g").attr("class", "axis axis--y-results");
             // No X axis needed for single stacked bar
             return svg;
        }

        const resultsSvg1 = createResultsChart('results-chart1');
        const resultsSvg2 = createResultsChart('results-chart2');
        const tooltip = d3.select("body").append("div").attr("class", "tooltip");

        function updateResultsCharts() {
            const scenario1Key = scenarioSelect1.value;
            const scenario2Key = scenarioSelect2.value;
            const data1 = resultsData[scenario1Key];
            const data2 = resultsData[scenario2Key];

            resultsScenario1Name.textContent = data1.name;
            resultsScenario2Name.textContent = data2.name;
            resultsPRM1.textContent = data1.prm.toFixed(1);
            resultsPRM2.textContent = data2.prm.toFixed(1);

            const stack = d3.stack().keys(techOrder);
            const series1 = stack([data1.mix]);
            const series2 = stack([data2.mix]);

            const maxCapacity = Math.max(d3.max(series1[series1.length-1], d => d[1]), d3.max(series2[series2.length-1], d => d[1]));
            resultsY.domain([0, maxCapacity * 1.1]).nice();

            // Update Y axis for both charts
            resultsSvg1.select(".axis--y-results").call(d3.axisLeft(resultsY));
            resultsSvg2.select(".axis--y-results").call(d3.axisLeft(resultsY));

            // Update Chart 1
            const bars1 = resultsSvg1.selectAll(".serie").data(series1);
            bars1.enter().append("g")
                .attr("class", d => `serie ${techColors[d.key]}`)
              .merge(bars1)
              .selectAll("rect")
              .data(d => d)
              .join("rect")
                .attr("x", resultsX("Mix"))
                .attr("y", d => resultsY(d[1]))
                .attr("height", d => resultsY(d[0]) - resultsY(d[1]))
                .attr("width", resultsX.bandwidth())
                .on("mouseover", (event, d) => {
                    const parentData = d3.select(event.currentTarget.parentNode).datum();
                    const tech = parentData.key;
                    const value = d[1] - d[0];
                    tooltip.transition().duration(200).style("opacity", .9);
                    tooltip.html(`${tech}: ${value.toFixed(1)} GW`)
                        .style("left", (event.pageX + 5) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", () => {
                    tooltip.transition().duration(500).style("opacity", 0);
                });

             // Update Chart 2
             const bars2 = resultsSvg2.selectAll(".serie").data(series2);
             bars2.enter().append("g")
                 .attr("class", d => `serie ${techColors[d.key]}`)
               .merge(bars2)
               .selectAll("rect")
               .data(d => d)
               .join("rect")
                 .attr("x", resultsX("Mix"))
                 .attr("y", d => resultsY(d[1]))
                 .attr("height", d => resultsY(d[0]) - resultsY(d[1]))
                 .attr("width", resultsX.bandwidth())
                 .on("mouseover", (event, d) => {
                    const parentData = d3.select(event.currentTarget.parentNode).datum();
                    const tech = parentData.key;
                    const value = d[1] - d[0];
                    tooltip.transition().duration(200).style("opacity", .9);
                    tooltip.html(`${tech}: ${value.toFixed(1)} GW`)
                        .style("left", (event.pageX + 5) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", () => {
                    tooltip.transition().duration(500).style("opacity", 0);
                });
        }

        scenarioSelect1.addEventListener('change', updateResultsCharts);
        scenarioSelect2.addEventListener('change', updateResultsCharts);
        // Set initial selection different for better comparison
        scenarioSelect1.value = "EO_SCIM";
        scenarioSelect2.value = "CM_SCIM";
        updateResultsCharts(); // Initial call

    </script>

</body>
</html>